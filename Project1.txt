
Project: 1

Client has required for a concrete Database for their Master records. As a part of project team, you are required to create
an EMPMaster table in DB2 and create a COBOL application that would take in a PS file as its input and update the EMPMaster
table based on the entries given in the PS file.
Employees Master records are maintained in EMPMaster table in DB2 which records the following fields.
 
    EMPID     ENAME     DEPT     SALARY     PH-NO

Organization maintains a PS dataset called as WorkFile which maintains their daily request of recording new employee joining, 
change of personal information, department or salary change from HR team.

    Use the PS file as input file which is given with the following details.
    EMPID     ENAME     DEPT     SALARY     PH-NO      STATUS     REMARKS
    10001     XYZ       SALES    50000      044-123456   I
    10023     ABC       ACCT     50000      044-123456   U
    10012     PQR       FINS     50000      044-123456   D
    (Hint: minimum 15 records has to be present)

Write a COBOL program to read records from the above given PS dataset and verify the status.
if Status is 'I' then insert details from EMPID to PH-NO into the EMPMASTER table and update the PS file status to 'F'
indicating finished for sucess or 'P' indicating as Pending for unsuccess and give the remarks.
if Status is 'U' then modify that record in EMPMASTER table with the given values in PS file and change the PS file status 
to 'F' indicating finished for sucess or 'P' indicating as Pending for unsuccess and give the remarks.
if Status is 'D' then delete that record from EMPMASTER table and change the PS file status to 'F' indicating finished for 
sucess or 'P' indicating as Pending for unsuccess and give the remarks.

Remarks should be
1. 'Success' for all successful operations.
2. Appropriate error message based on the returned SQL status code.

    Hint: After the execution of above program PS will be as below
    EMPID     ENAME     DEPT     SALARY     PH-NO      STATUS     REMARKS
    10001     XYZ       SALES    50000      044-123456   P        Records already present
    10023     ABC       ACCT     50000      044-123456   P        Records not found
    10012     PQR       FINS     50000      044-123456   F        Success

  Create EMPMaster table using below code:  

  CREATE TABLE EMPMASTER
  (
  IEMPID NUMERIC(5) NOT NULL PRIMARY KEY,
  IENAME VARCHAR(3) NOT NULL,
  IDEPT VARCHAR(5),
  ISAL NUMERIC(5),
  IPHNO VARCHAR(10)
  )IN WPR109DB.WPR109TS;

  Create unique index to table using below code: 

  CREATE UNIQUE INDEX ABCDE ON EMPMASTER(IEMPID);

  Dclgen is created as AG1:

  Cobol code for given question is given below:

  IDENTIFICATION DIVISION.                      
  PROGRAM-ID. PROG.                             
  ENVIRONMENT DIVISION.                         
  INPUT-OUTPUT SECTION.                         
  FILE-CONTROL.                                                   
       SELECT INFILE ASSIGN TO DD1.             
  DATA DIVISION.                                
  FILE SECTION.                                 
  COPY CPYEMP.                                  
  WORKING-STORAGE SECTION. 
         EXEC SQL                
              INCLUDE SQLCA      
         END-EXEC.               
         EXEC SQL
              INCLUDE AG1
         END-EXEC.                                                
  77 WS-FLAG PIC X(1) VALUE 'Y'.                
  PROCEDURE DIVISION.                           
  MAIN-PARA.                                    
        PERFORM OPEN-PARA.                      
        PERFORM WRITE-PARA UNTIL WS-FLAG = 'N'. 
        PERFORM CLOSE-PARA.                     
        STOP RUN.                               
  OPEN-PARA.                                                                     
        OPEN I-O INFILE.                                                  
  WRITE-PARA.                                     
        READ INFILE                          
        AT END                                    
        DISPLAY "END OF FILE"                     
        MOVE 'N' TO WS-FLAG                       
        NOT AT END 
        MOVE EMPID TO HV-IEMPID     
        MOVE EMPNAME TO HV-IENAME
        MOVE DEPT TO HV-IDEPT 
        MOVE SAL TO HV-ISAL 
        MOVE PHNO TO HV-IPHNO                                  
        IF STS = 'I' 
        EXEC SQL
             SELECT IEMPID,IENAME
             INTO :HV-IEMPID,:HV-IENAME 
             FROM EMPMASTER
             WHERE IEMPID=:HV-IEMPID  
        END-EXEC
        IF SQLCODE = 0 
             MOVE 'P' TO STS                           
             MOVE 'RECORDS ALREADY PRESENT' TO RMARK 
        ELSE
             EXEC SQL                                      
              INSERT INTO EMPMASTER                
              (IEMPID,IENAME,IDEPT,ISAL,IPHNO)                     
               VALUES                                  
              (:HV-IEMPID,:HV-IENAME,:HV-IDEPT,:HV-ISAL,
               :HV-IPHNO)        
             END-EXEC
             MOVE 'F' TO STS                           
             MOVE 'SUCCESS' TO RMARK 
        END-IF  
        END-IF      
        IF STS = 'U' 
        EXEC SQL
             SELECT IEMPID,IENAME
             INTO :HV-IEMPID,:HV-IENAME 
             FROM EMPMASTER
             WHERE IEMPID=:HV-IEMPID  
        END-EXEC
        IF SQLCODE = 0 
             EXEC SQL
              UPDATE EMPMASTER                 
              SET IEMPID=:HV-IEMPID,IENAME=:HV-IENAME,
               IDEPT=:HV-IDEPT,ISAL=:HV-ISAL,IPHNO=:HV-IPHNO   
              WHERE IEMPID=:HV-IEMPID           
             END-EXEC
             MOVE 'F' TO STS                       
             MOVE 'SUCCESS' TO RMARK   
        ELSE 
             MOVE 'P' TO STS                       
             MOVE 'RECORDS NOT FOUND' TO RMARK    
        END-IF  
        END-IF 
        IF STS = 'D' 
        EXEC SQL
             SELECT IEMPID,IENAME
             INTO :HV-IEMPID,:HV-IENAME 
             FROM EMPMASTER
             WHERE IEMPID=:HV-IEMPID  
        END-EXEC
        IF SQLCODE = 0 
             EXEC SQL
              DELETE FROM EMPMASTER       
              WHERE IEMPID=:HV-IEMPID           
             END-EXEC 
             MOVE 'F' TO STS                       
             MOVE 'SUCCESS' TO RMARK   
        ELSE 
             MOVE 'P' TO STS                       
             MOVE 'RECORDS NOT FOUND' TO RMARK    
        END-IF  
        END-IF                    
        REWRITE IN-REC    
        END-READ.         
  CLOSE-PARA.             
        CLOSE INFILE.         

  In copy book(CPYEMP):
      
  FD INFILE.              
  01 IN-REC.              
    02 EMPID PIC 9(5).   
    02 FILLER PIC X.    
    02 EMPNAME PIC X(3). 
    02 FILLER PIC X.    
    02 DEPT PIC X(5). 
    02 FILLER PIC X.    
    02 SAL PIC 9(5). 
    02 FILLER PIC X.    
    02 PHNO PIC X(10). 
    02 FILLER PIC X.      
    02 STS PIC X.   
    02 FILLER PIC X.   
    02 RMARK PIC X(23).   
    02 FILLER PIC X(22).



